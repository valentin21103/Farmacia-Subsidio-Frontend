<nav class="navbar">
  <div class="nav-brand">
    <div class="brand-logo">üíä</div>
    <h2>Farmacia Subsidio</h2>
  </div>
  <div class="nav-info">
    <span class="welcome-text">Hola, <strong>{{ usuarioNombre }}</strong></span>
    <button (click)="cerrarSesion()" class="btn-logout">Salir</button>
  </div>
</nav>

<div class="dashboard-container">
  
  <div class="left-panel">
    
    <div class="welcome-banner">
      <div class="banner-content">
        <h1>Bienvenido, {{ usuarioNombre }} üëã</h1>
        <p>Estos son los medicamentos disponibles para solicitarlos a trav√©s de tus subsidios de salud.</p>
      </div>
      <div class="banner-decoration"></div>
    </div>

    <div class="section-header">
      <h3>Medicamentos Disponibles</h3>
      
      <div class="search-wrapper">
        <span class="search-icon">üîç</span>
        <input type="text" placeholder="Buscar medicamentos..." [(ngModel)]="busquedaPrincipal" class="main-search">
        <span class="mic-icon">üé§</span>
      </div>
    </div>

    <div class="medicamentos-grid">
      
      <div class="card-medicamento" *ngFor="let item of misMedicamentosFiltrados; let i = index">
        
        <div class="card-top">
          <div class="card-info-top">
            <h4>{{ item.nombre }}</h4>
            <div class="precio-block">
              <span class="precio-actual">${{ item.precio }}</span>
              <span class="precio-viejo" *ngIf="i % 2 === 0">${{ item.precio * 1.3 | number:'1.0-0' }}</span>
            </div>
          </div>
          
          <div class="card-icon-container">
            <span class="pill-icon">üíä</span>
          </div>
        </div>

        <div class="card-bottom">
          <div class="badge-subsidio">
            <span class="check-icon">‚úì</span> Subsidio Aprobado
          </div>
          
          <button class="btn-card btn-blue" (click)="PedirSubsidio(item)">
             Solicitar Subsidio
          </button>
        </div>

      </div>

      <div *ngIf="misMedicamentosFiltrados.length === 0" style="width: 100%; text-align: center; color: #888; grid-column: span 3;">
        <p>No se encontraron medicamentos con ese nombre.</p>
      </div>

    </div>

  </div>

  <div class="right-panel">

    <div class="sidebar-card card-solicitar">
      <div class="card-header">
        <h3>Solicitar medicamentos ></h3>
      </div>

      <div class="lista-lateral">
        <h3>Medicamentos Mas Pedidos</h3>

        <div class="item-solicitud" *ngFor="let sol of catalogoFiltrado.slice(0, 3)">
          <div class="sol-info">
            <strong>{{ sol.nombre }}</strong>
            <span class="sol-fecha">23 abril - 23 Abr</span>
          </div>
        </div>
        
        <button routerLink="/bibliotecaMedi" class="btn-ver-todos">
          Ver Todos los Medicamentos
        </button>
      </div>
    </div>

    <div class="sidebar-card card-pendientes">
      <div class="card-header">
        <h3 class="titulo-pendientes">Medicamentos Pendientes</h3>
      </div>
       
       <div class="card-illustration">
         <div class="pill-illustration"></div>
       </div>

      <div class="lista-lateral">
        <div class="item-solicitud" *ngFor="let sol of solicitudesPendientes.slice()">
          <div class="sol-info">
            <strong>{{ sol.medicamentoNombre }}</strong>
            <span class="sol-fecha">Solicitado recientemente</span>
          </div>
          <span class="badge-estado" [ngClass]="sol.estado.toLowerCase()">
            {{ sol.estado }}
          </span>
        </div>
      </div>
    </div>

  </div>
</div>

<div class="modal-overlay" *ngIf="mostrarModalTicket">
  <div class="ticket-container">
    
    <div class="ticket-header">
      <h3>¬°Subsidio Aprobado! üéâ</h3>
      <span class="ticket-id">#SUB-{{ datosTicket.fecha | date:'mmss' }}</span>
    </div>

    <div class="ticket-body">
      
      <div class="info-row">
        <span class="label">Solicitante:</span>
        <span class="value user">{{ datosTicket.solicitante }}</span>
      </div>
      
      <div class="info-row">
        <span class="label">Fecha:</span>
        <span class="value">{{ datosTicket.fecha | date:'dd/MM/yyyy HH:mm' }}</span>
      </div>

      <div class="divider"></div>

      <div class="medicamento-info">
        <h4>{{ datosTicket.medicamento }}</h4>
        
        <div class="precios-container">
          <div class="precio-col">
            <span class="p-label">Precio Lista</span>
            <span class="p-valor tachado">${{ datosTicket.precioOriginal }}</span>
          </div>
          <div class="precio-col destacado">
            <span class="p-label">Con Subsidio (60%)</span>
            <span class="p-valor final">${{ datosTicket.precioFinal | number:'1.0-0' }}</span>
          </div>
        </div>
      </div>

      <div class="qr-section">
        <div class="qr-box">
          <img [src]="datosTicket.codigoQR" alt="QR Subsidio">
        </div>
        <p class="qr-warning">
          ‚ö†Ô∏è Tienes <strong>12 horas</strong> para presentar este c√≥digo en la farmacia.
        </p>
      </div>

    </div>

    <div class="ticket-footer">
      <button class="btn-cerrar-modal" (click)="cerrarModal()">Entendido, cerrar</button>
    </div>

  </div>
</div>